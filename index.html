<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gardner Grove Cemetery | Secure Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --sf-text: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --apple-blue: #0071e3;
            --apple-green: #34c759;
            --apple-red: #ff3b30;
            --bg-dark: #000000;
            --glass: rgba(255, 255, 255, 0.85);
            --drawer-bg: #fbfbfd;
        }

        body {
            font-family: var(--sf-text);
            background-color: var(--bg-dark);
            color: #f5f5f7;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* --- Nav --- */
        nav {
            background: rgba(22, 22, 23, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            height: 52px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            z-index: 5000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-content {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo { font-size: 14px; font-weight: 600; letter-spacing: 0.5px; opacity: 0.9; display: flex; align-items: center; gap: 8px; }
        
        .cart-trigger {
            background: none; border: none; color: white; cursor: pointer; position: relative;
            font-size: 18px; transition: 0.2s;
        }
        .cart-trigger:hover { opacity: 0.7; }
        .cart-badge {
            position: absolute; top: -6px; right: -10px; background: var(--apple-blue);
            font-size: 10px; min-width: 16px; height: 16px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-weight: bold;
            border: 2px solid #1a1a1a;
        }

        /* --- Map Area --- */
        .main-container {
            padding-top: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .map-container {
            position: relative;
            width: 1440px;
            height: 1080px;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
            background: #1d1d1f;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .cemetery-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .overlay-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* Dynamic Plot Styling */
        .plot-path { 
            stroke-width: 2.5px; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            fill: rgba(255,255,255,0.02);
        }
        
        /* Available State */
        .status-available .plot-path { stroke: var(--apple-green); }
        .status-available:hover .plot-path { fill: rgba(52, 199, 89, 0.35); stroke: white; cursor: pointer; }

        /* Taken/Sold State */
        .status-taken .plot-path { stroke: #555; fill: rgba(255,255,255,0.1); }
        .status-taken:hover .plot-path { stroke: var(--apple-red); fill: rgba(255, 59, 48, 0.2); cursor: not-allowed; }

        /* --- Glass Popup --- */
        .info-card {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 400px;
            background: var(--glass);
            backdrop-filter: blur(40px);
            border-radius: 24px;
            color: #1d1d1f;
            display: none; z-index: 4000;
            box-shadow: 0 40px 100px rgba(0,0,0,0.7);
            opacity: 0; transition: all 0.3s ease;
            pointer-events: none;
        }
        .info-card.visible { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .info-card.locked { pointer-events: auto; }

        .card-header { padding: 30px 30px 10px; display: flex; justify-content: space-between; }
        .card-header h2 { margin: 0; font-size: 28px; font-weight: 600; }
        .card-body { padding: 0 30px 30px; }
        
        .info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .info-label { font-size: 11px; font-weight: 700; color: #86868b; text-transform: uppercase; }
        .info-value { font-size: 15px; font-weight: 500; text-align: right; }

        .btn-action {
            width: 100%; padding: 16px; border-radius: 12px; border: none;
            font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s;
            margin-top: 20px;
        }
        .btn-add { background: var(--apple-blue); color: white; }
        .btn-add:hover { transform: scale(1.02); background: #0077ed; }

        /* --- Cart Drawer (Slide Out) --- */
        .cart-drawer {
            position: fixed; top: 0; right: -450px; width: 400px; height: 100%;
            background: var(--drawer-bg); color: #1d1d1f;
            z-index: 6000; box-shadow: -10px 0 40px rgba(0,0,0,0.5);
            transition: right 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .cart-drawer.open { right: 0; }
        
        .drawer-header { padding: 30px; border-bottom: 1px solid #e5e5e5; display: flex; justify-content: space-between; align-items: center; }
        .drawer-body { flex: 1; padding: 30px; overflow-y: auto; }
        .drawer-footer { padding: 30px; background: white; border-top: 1px solid #e5e5e5; }

        .cart-item {
            background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;
        }
        .remove-btn { color: var(--apple-red); cursor: pointer; font-size: 13px; font-weight: 600; margin-top: 5px; display: inline-block; }

        /* --- Checkout Modal --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 7000; display: none; align-items: center; justify-content: center;
        }
        .modal-card {
            background: #fff; color: #1d1d1f; width: 500px; padding: 40px;
            border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 12px; font-weight: 700; color: #86868b; margin-bottom: 8px; uppercase; }
        .modal-input {
            width: 100%; padding: 14px; border: 1px solid #d2d2d7; border-radius: 8px; font-size: 16px; box-sizing: border-box;
        }

        /* --- Success Animation --- */
        .success-icon { font-size: 50px; color: var(--apple-green); margin-bottom: 20px; text-align: center; display: block; }
    </style>
</head>
<body>

    <nav>
        <div class="nav-content">
            <div class="logo"><i class="fa-solid fa-church"></i> GARDNER GROVE</div>
            <button class="cart-trigger" onclick="toggleCart()">
                <i class="fa-solid fa-cart-shopping"></i>
                <span id="cartCount" class="cart-badge">0</span>
            </button>
        </div>
    </nav>

    <div class="main-container">
        <div class="map-container">
            <img src="CemetryMap.jpg" class="cemetery-img">
            <svg class="overlay-svg" viewBox="0 0 1440 1080" xmlns="http://www.w3.org/2000/svg" id="mapSVG">
                <g id="A11"><polygon class="plot-path" points="1157.83 66.09 1172.17 96.61 1193.83 96.61 1178.17 66.09 1157.83 66.09"/></g>
                <g id="A12"><polygon class="plot-path" points="1133.3 66.09 1146.87 99.22 1166.96 99.22 1152.61 66.09 1133.3 66.09"/></g>
                <g id="A13"><polygon class="plot-path" points="1104.35 67.65 1115.04 99.22 1137.48 99.22 1125.74 67.65 1104.35 67.65"/></g>
                <g id="A14"><polygon class="plot-path" points="1083.22 67.65 1092.61 99.22 1111.39 99.22 1101.48 67.65 1083.22 67.65"/></g>
                <g id="A15"><polygon class="plot-path" points="1050.35 62.7 1060.26 96.61 1081.91 96.61 1072 62.7 1050.35 62.7"/></g>
            </svg>

            <div id="infoCard" class="info-card">
                <div class="card-header">
                    <h2 id="cardID">Plot</h2>
                    <i class="fa-solid fa-xmark" style="cursor:pointer; color:#86868b;" onclick="dismissCard()"></i>
                </div>
                <div class="card-body" id="cardBody"></div>
            </div>
        </div>
    </div>

    <div id="cartDrawer" class="cart-drawer">
        <div class="drawer-header">
            <h2 style="margin:0; font-size:22px;">Shopping Cart</h2>
            <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:20px;" onclick="toggleCart()"></i>
        </div>
        <div class="drawer-body" id="cartItems">
            <div style="text-align:center; color:#86868b; margin-top:50px;">Your cart is empty.</div>
        </div>
        <div class="drawer-footer">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; font-weight:600; font-size:18px;">
                <span>Total</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="btn-action btn-add" onclick="openCheckout()">Proceed to Checkout</button>
        </div>
    </div>

    <div id="checkoutModal" class="modal-overlay">
        <div class="modal-card">
            <h2 style="margin-top:0;">Secure Checkout</h2>
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" class="modal-input" placeholder="John Doe" id="ckName">
            </div>
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" class="modal-input" placeholder="john@example.com">
            </div>
            
            <hr style="border:0; border-top:1px solid #eee; margin:25px 0;">
            
            <h3 style="margin-bottom:10px;">Payment Method</h3>
            <p style="font-size:14px; color:#666; margin-bottom:15px; background:#f5f5f7; padding:10px; border-radius:8px;">
                <i class="fa-solid fa-circle-info"></i> Note: The card is in the overcoat.
            </p>
            <div class="input-group">
                <label>Card Number</label>
                <input type="text" class="modal-input" placeholder="0000 0000 0000 0000">
            </div>
            <div style="display:flex; gap:15px;">
                <div class="input-group" style="flex:1;">
                    <label>Expiry</label>
                    <input type="text" class="modal-input" placeholder="MM/YY">
                </div>
                <div class="input-group" style="flex:1;">
                    <label>CVC</label>
                    <input type="text" class="modal-input" placeholder="123">
                </div>
            </div>

            <button class="btn-action btn-add" onclick="confirmOrder()">Pay & Place Order</button>
            <button class="btn-action" style="background:none; color:#666; margin-top:0;" onclick="closeCheckout()">Cancel</button>
        </div>
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fa-solid fa-circle-check success-icon"></i>
            <h2 style="margin:0;">Order Confirmed!</h2>
            <p style="color:#666; margin-top:10px;">Thank you for your purchase.</p>
            
            <div style="background:#f5f5f7; padding:20px; border-radius:12px; margin:20px 0; text-align:left;">
                <div style="font-size:12px; color:#86868b; text-transform:uppercase; font-weight:700;">Order #88392</div>
                <div id="receiptItems" style="margin-top:10px; font-weight:500;"></div>
            </div>

            <button class="btn-action btn-add" onclick="closeSuccess()">Return to Map</button>
        </div>
    </div>

    <script>
        // --- DATA STATE ---
        const plotData = {
            "A11": { status: "Available", price: 1200, row: "1", grave: "1", notes: "Premium Visibility." },
            "A12": { status: "Taken", name: "Leroy McGee", life: "1947 — 1995", notes: "White Marble Military Headstone" },
            "A13": { status: "Taken", name: "Mrs. Bessie M. Williams", life: "1914 — 2004", notes: "Gray Headstone" },
            "A14": { status: "Taken", name: "Gelester Williams", life: "1925 — 1968", notes: "Military Flat Marker" },
            "A15": { status: "Available", price: 1200, row: "1", grave: "5", notes: "Archive Section." }
        };

        let cart = []; // Array of IDs
        let isCardLocked = false;
        
        // --- INITIALIZATION ---
        function initMap() {
            document.querySelectorAll('g[id]').forEach(plot => {
                const id = plot.id;
                renderPlotStyle(id); // Apply initial color
                
                // Hover Event
                plot.addEventListener('mouseenter', () => {
                    if (!isCardLocked) showInfoCard(id);
                });

                // Click Event
                plot.addEventListener('click', (e) => {
                    e.stopPropagation();
                    isCardLocked = true;
                    showInfoCard(id);
                    document.getElementById('infoCard').classList.add('locked');
                });
            });
        }
        
        // Helper to color plots based on status
        function renderPlotStyle(id) {
            const plot = document.getElementById(id);
            const data = plotData[id];
            plot.classList.remove('status-available', 'status-taken');
            
            if (data.status === "Available") {
                plot.classList.add('status-available');
            } else {
                plot.classList.add('status-taken');
            }
        }

        // --- POPUP CARD ---
        function showInfoCard(id) {
            const data = plotData[id];
            const card = document.getElementById('infoCard');
            document.getElementById('cardID').innerText = "Plot " + id;
            
            let html = `
                <div class="info-row"><span class="info-label">Status</span><span class="info-value" style="color:${data.status === 'Available' ? 'var(--apple-green)' : 'var(--apple-red)'}">${data.status}</span></div>
            `;
            
            if (data.name) html += `<div class="info-row"><span class="info-label">Occupant</span><span class="info-value">${data.name}</span></div>`;
            if (data.life) html += `<div class="info-row"><span class="info-label">Dates</span><span class="info-value">${data.life}</span></div>`;
            if (data.row) html += `<div class="info-row"><span class="info-label">Location</span><span class="info-value">Row ${data.row}, Grave ${data.grave}</span></div>`;

            let footerHtml = '';
            
            if (data.status === "Available") {
                // Check if already in cart
                if (cart.includes(id)) {
                    footerHtml = `<button class="btn-action" style="background:#eee; color:#333; cursor:default;">In Cart</button>`;
                } else {
                    footerHtml = `<button class="btn-action btn-add" onclick="addToCart('${id}')">Add to Cart • $${data.price.toLocaleString()}</button>`;
                }
            } else {
                footerHtml = `<div style="text-align:center; padding:20px; color:#86868b; font-size:14px;">This plot is currently reserved.</div>`;
            }

            document.getElementById('cardBody').innerHTML = html + footerHtml;
            card.classList.add('visible');
        }

        function dismissCard() {
            isCardLocked = false;
            document.getElementById('infoCard').classList.remove('visible', 'locked');
        }

        document.body.addEventListener('click', () => dismissCard());

        // --- CART LOGIC ---
        function addToCart(id) {
            if (!cart.includes(id)) {
                cart.push(id);
                updateCartUI();
                dismissCard();
                toggleCart(); // Auto open cart
            }
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item !== id);
            updateCartUI();
        }

        function updateCartUI() {
            // Update Badge
            document.getElementById('cartCount').innerText = cart.length;

            // Render Items
            const container = document.getElementById('cartItems');
            if (cart.length === 0) {
                container.innerHTML = `<div style="text-align:center; color:#86868b; margin-top:50px;">Your cart is empty.</div>`;
                document.getElementById('cartTotal').innerText = "$0.00";
                return;
            }

            let html = '';
            let total = 0;

            cart.forEach(id => {
                const data = plotData[id];
                total += data.price;
                html += `
                    <div class="cart-item">
                        <div>
                            <div style="font-weight:600; font-size:16px;">Plot ${id}</div>
                            <div style="font-size:13px; color:#666;">Row ${data.row}, Grave ${data.grave}</div>
                            <div class="remove-btn" onclick="removeFromCart('${id}')">Remove</div>
                        </div>
                        <div style="font-weight:600;">$${data.price.toLocaleString()}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
            document.getElementById('cartTotal').innerText = "$" + total.toLocaleString() + ".00";
        }

        function toggleCart() {
            document.getElementById('cartDrawer').classList.toggle('open');
        }

        // --- CHECKOUT LOGIC ---
        function openCheckout() {
            if (cart.length === 0) return alert("Cart is empty");
            toggleCart(); // Close drawer
            document.getElementById('checkoutModal').style.display = 'flex';
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').style.display = 'none';
        }

        function confirmOrder() {
            const name = document.getElementById('ckName').value || "Valued Customer";
            
            // 1. Process "Backend" Data Changes
            cart.forEach(id => {
                plotData[id].status = "Taken"; // Change status
                plotData[id].name = name;      // Assign owner
                plotData[id].life = "Reserved " + new Date().getFullYear();
                delete plotData[id].price;     // Remove price
                
                // Update Visuals on Map
                renderPlotStyle(id);
            });

            // 2. Prepare Receipt
            const receiptHtml = cart.map(id => `<div>Plot ${id} - Paid</div>`).join('');
            document.getElementById('receiptItems').innerHTML = receiptHtml;

            // 3. Clear Cart & Show Success
            cart = [];
            updateCartUI();
            closeCheckout();
            document.getElementById('successModal').style.display = 'flex';
        }

        function closeSuccess() {
            document.getElementById('successModal').style.display = 'none';
        }

        // Start
        initMap();

    </script>
</body>
</html>
